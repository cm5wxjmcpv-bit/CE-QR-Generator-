<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Martinsville Fire & EMS CE Portal</title>
<link rel="stylesheet" href="style.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <div class="overlay"></div>
  <div class="container fade-in">
    <img src="ABE9E472-6FA5-46E6-866D-992B713B5B5B.JPG" class="logo" alt="Martinsville Fire & EMS Logo">
    <h1>Martinsville<br>Fire & EMS<br>Continuing Education Portal</h1>
    <p class="desc">Complete all fields to record your CE attendance.</p>

    <input id="first" placeholder="First Name" />
    <input id="last" placeholder="Last Name" />
    <input id="cert" placeholder="Certification #" />
    <button id="submitBtn" onclick="submitForm()">Submit</button>
    <div id="message"></div>

    <footer>© 2025 City of Martinsville Fire & EMS • CE Portal v3.0</footer>
  </div>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbz4fAjnjqfybEBRVnFhQcnAnlOfyRUlYP5f34yZMUjaaSsBwRzPmaK6tfWFsB4kha-6/exec";

function vibrate(ms=30){ if("vibrate" in navigator) navigator.vibrate(ms); }

function submitForm() {
  vibrate(50);
  const f = document.getElementById('first').value.trim().toUpperCase();
  const l = document.getElementById('last').value.trim().toUpperCase();
  const c = document.getElementById('cert').value.trim().toUpperCase();
  if (!f || !l || !c) {
    alert("Please fill in all fields.");
    return;
  }

  document.getElementById('message').innerText = "Submitting record...";
  const qrDiv = document.createElement("div");
  new QRCode(qrDiv, { text: `${c}${l}|${f}`, width: 200, height: 200 });

  setTimeout(() => {
    const imgEl = qrDiv.querySelector("img");
    const imgData = imgEl ? imgEl.src : "";
    const payload = {
      codeText: `${c}${l}|${f}`,
      image: imgData,
      timestamp: new Date().toISOString()
    };

    fetch(SHEET_URL, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    }).catch(err => console.log("Error posting:", err));

    document.getElementById('message').innerText =
      "✅ Submission received — your CE record has been logged.";
    document.getElementById('first').value = "";
    document.getElementById('last').value = "";
    document.getElementById('cert').value = "";
  }, 600);
}
</script>
</body>
</html>
