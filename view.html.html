<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CE QR Generator – Admin View</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
 body{font-family:Arial,sans-serif;background:#fff;margin:20px}
 h1{text-align:center}
 button{margin:5px;padding:8px 16px;cursor:pointer}
 .entry{border-bottom:1px solid #ccc;padding:10px 0}
 .hidden{display:none}
</style>
</head>
<body>
<h1>CE QR Generator – Admin View</h1>
<div id="login">
  <p>Enter Password:</p>
  <input type="password" id="pw" autocomplete="current-password" inputmode="text">
  <button id="loginBtn">Login</button>
  <p id="loginMsg" style="color:red;"></p>
</div>

<div id="admin" class="hidden">
  <button id="exportBtn">Export All to PDF</button>
  <button id="deleteBtn">Delete All</button>
  <button id="logoutBtn">Logout</button>
  <div id="records"></div>
</div>

<script>
// Simple, mobile-safe password check
const realPW = "Firefighter522539";

document.getElementById('loginBtn').addEventListener('click', checkPW);
document.getElementById('pw').addEventListener('keydown', (e)=>{
  if(e.key === 'Enter'){ checkPW(); }
});

function checkPW(){
  const p=document.getElementById('pw').value.trim();
  if(p===realPW){
    document.getElementById('login').classList.add('hidden');
    document.getElementById('admin').classList.remove('hidden');
    document.getElementById('loginMsg').innerText="";
    loadRecords();
  }else{
    document.getElementById('loginMsg').innerText="Incorrect password.";
  }
}

document.getElementById('deleteBtn').addEventListener('click', deleteAll);
document.getElementById('exportBtn').addEventListener('click', exportPDF);
document.getElementById('logoutBtn').addEventListener('click', logout);

function loadRecords(){
  const recs=JSON.parse(localStorage.getItem("qrRecords")||"[]");
  const div=document.getElementById('records');
  div.innerHTML='';
  if(!recs.length){div.innerHTML="<p>No records found.</p>";return;}
  recs.forEach(r=>{
    const e=document.createElement('div');e.className='entry';
    e.innerHTML=`<p><strong>${r.text}</strong><br>${r.time||""}</p>`;
    if(r.img){
      const img=new Image(); img.src=r.img; img.width=150;
      e.appendChild(img);
    }
    div.appendChild(e);
  });
}

function deleteAll(){
  if(confirm("Are you sure you want to delete all records?")){
    localStorage.removeItem("qrRecords");
    document.getElementById('records').innerHTML="<p>All records deleted.</p>";
  }
}

function exportPDF(){
  const { jsPDF } = window.jspdf;
  const doc=new jsPDF();
  const recs=JSON.parse(localStorage.getItem("qrRecords")||"[]");
  let y=20;
  doc.setFontSize(14);
  doc.text("CE QR Generator Records",10,10);
  for(let i=0;i<recs.length;i++){
    const r=recs[i];
    if(y>260){doc.addPage();y=20;}
    doc.text(r.text,10,y);
    if(r.img){doc.addImage(r.img,"PNG",10,y+5,40,40);}
    y+=50;
  }
  doc.save("QR_Records.pdf");
}

function logout(){
  document.getElementById('admin').classList.add('hidden');
  document.getElementById('login').classList.remove('hidden');
  document.getElementById('pw').value='';
}
</script>
</body>
</html>